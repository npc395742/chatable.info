<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chatable Information Center</title>
<style>
  body { 
    font-family: Arial, Helvetica, sans-serif; 
    display:flex; 
    flex-direction:column;
    align-items:center; 
    justify-content:flex-start; 
    height:100vh; 
    background:#f6f6f6; 
    margin:0;
    padding-top:50px;
    position: relative;
  }
  #topBar {
    width:100%;
    background:#1a73e8;
    color:#fff;
    padding:10px 20px;
    display:none;
    position:fixed;
    top:0;
    left:0;
    z-index:1000;
    box-shadow:0 2px 6px rgba(0,0,0,0.2);
    display:flex;
    align-items:center;
  }
  #topBar button {
    background:#fff;
    color:#1a73e8;
    border:none;
    border-radius:4px;
    padding:6px 12px;
    cursor:pointer;
    font-weight:bold;
  }
  #box { width:640px; text-align:center; margin-top:20px; }
  input[type="text"] { width:70%; padding:14px 18px; font-size:18px; border-radius:24px; border:1px solid #ddd; }
  button { padding:10px 18px; font-size:16px; margin-left:8px; border-radius:8px; cursor:pointer; }
  #results { margin-top:20px; text-align:left; background:#fff; padding:16px; border-radius:8px; box-shadow:0 1px 6px rgba(0,0,0,0.08); min-height:200px; width:640px; }
  #version { position: fixed; bottom: 10px; right: 10px; font-size: 12px; color: #888; font-style: normal; }
  .result-title { font-weight:700; font-size:16px; color:#1a0dab; text-decoration:none; }
  .result-snippet { color:#333; display:block; margin-top:4px; }
  iframe { width:100%; height:80vh; border:none; margin-top:50px; }
</style>
</head>
<body>

<div id="topBar">
  <button id="backBtn">‚Üê Back to Search</button>
</div>

<div id="box">
  <h1 style="font-weight:400">Chatable Information Center</h1>
  <form id="searchForm">
    <input id="q" type="text" placeholder="Search with Chatable..." autocomplete="off" />
    <button type="submit" id="go">Search</button>
  </form>
  <div id="results"></div>
</div>

<div id="version">Version 1.00.21</div>

<script>
let currentQuery = '';
let iframe = null;

async function doSearch() {
  currentQuery = document.getElementById('q').value.trim();
  if (!currentQuery) return;

  const resultsDiv = document.getElementById('results');
  resultsDiv.innerHTML = '<em>Loading...</em>';
  document.getElementById('go').disabled = true;

  // remove iframe if exists
  if (iframe) {
    iframe.remove();
    iframe = null;
    document.getElementById('topBar').style.display = 'none';
    document.getElementById('box').style.display = 'block';
  }

  try {
    // Wikipedia API search
    const url = `https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(currentQuery)}&utf8=&format=json&origin=*`;
    const response = await fetch(url);
    if (!response.ok) throw new Error(`Server error: ${response.status}`);
    const data = await response.json();

    const searchResults = data.query.search;
    let html = '';
    if (!searchResults || searchResults.length === 0) {
      html = '<h3>No results found.</h3>';
    } else {
      html = '<h3>Results</h3>';
      searchResults.forEach(item => {
        const title = item.title;
        const snippet = item.snippet.replace(/<\/?span[^>]*>/g, '');
        const link = `https://en.wikipedia.org/wiki/${encodeURIComponent(title)}`;
        html += `<div style="margin-bottom:14px;">
                   <a class="result-title" href="${link}" target="_blank" rel="noopener noreferrer" onclick="openLink(event,'${link}')">${escapeHtml(title)}</a>
                   <div class="result-snippet">${escapeHtml(snippet)}...</div>
                 </div>`;
      });
    }

    resultsDiv.innerHTML = html;
  } catch (err) {
    document.getElementById('results').innerHTML = `<strong>Error:</strong> ${escapeHtml(err.message)}`;
    console.error(err);
  } finally {
    document.getElementById('go').disabled = false;
  }
}

// Open link inside an iframe and show back button
function openLink(event, url) {
  event.preventDefault();
  document.getElementById('box').style.display = 'none';
  document.getElementById('topBar').style.display = 'flex';

  iframe = document.createElement('iframe');
  iframe.src = url;
  document.body.appendChild(iframe);
}

// Go back to search results
document.getElementById('backBtn').addEventListener('click', () => {
  if (iframe) {
    iframe.remove();
    iframe = null;
  }
  document.getElementById('topBar').style.display = 'none';
  document.getElementById('box').style.display = 'block';
});

function escapeHtml(str) {
  if (!str) return '';
  return String(str)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#039;');
}

document.getElementById('searchForm').addEventListener('submit', e => {
  e.preventDefault();
  doSearch();
});

document.getElementById('q').addEventListener('keydown', e => {
  if (e.key === 'Enter') { e.preventDefault(); doSearch(); }
});
</script>

</body>
</html>
